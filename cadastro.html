<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Grimório</title>
    <link rel="stylesheet" href="cadastro.css">
</head>

<body>

    <a href="listagem.html" class="botao-voltar">Voltar</a>

    <div class="container" id="estrelas-container"></div>

    <form onsubmit="event.preventDefault(); trataform()">
        <label for="id">ID</label>
        <input type="text" id="id" name="id">

        <label for="Nome">Nome</label>
        <input type="text" id="Nome" name="Nome">

        <label for="Tipodeocorrencia">Tipo de ocorrência</label>
        <input type="text" id="Tipodeocorrencia" name="Tipo de ocorrencia">

        <label for="Datadoevento">Data do evento</label>
        <input type="text" id="Datadoevento" name="Data do evento">

        <label for="lugar">Lugar</label>
        <input type="text" id="lugar" name="lugar">

        <label for="EntidadesEnvolvidas">Entidades envolvidas</label>
        <input type="text" id="EntidadesEnvolvidas" name="Entidades envolvidas">

        <label for="Niveldeatividadeparanormal">Nível de atividade paranormal</label>
        <input type="text" id="Niveldeatividadeparanormal" name="Nivel de atividade paranormal">

        <label for="Evidencias">Evidências</label>
        <input type="text" id="Evidencias" name="Evidencias">

        <label for="RituaisRealizados">Rituais realizados</label>
        <input type="text" id="RituaisRealizados" name="Rituais realizados">

        <input type="submit" value="Cadastrar">
        
    </form>

    <script>

        async function trataform() {
            const inputId = document.getElementById("id");
            const inputNome = document.getElementById("Nome");
            const inputTipodeocorrencia = document.getElementById("Tipodeocorrencia");
            const inputDatadoevento = document.getElementById("Datadoevento");
            const inputlugar = document.getElementById("lugar");
            const inputEntidadesEnvolvidas = document.getElementById("EntidadesEnvolvidas");
            const inputNiveldeatividadeparanormal = document.getElementById("Niveldeatividadeparanormal");
            const inputEvidencias = document.getElementById("Evidencias");
            const inputRituaisRealizados = document.getElementById("RituaisRealizados");

            const objGrimorio = {
                id: inputId.value,
                Nome: inputNome.value,
                Tipodeocorrencia: inputTipodeocorrencia.value,
                Datadoevento: inputDatadoevento.value,
                lugar: inputlugar.value,
                EntidadesEnvolvidas: inputEntidadesEnvolvidas.value,
                Niveldeatividadeparanormal: inputNiveldeatividadeparanormal.value,
                Evidencias: inputEvidencias.value,
                RituaisRealizados: inputRituaisRealizados.value
            };

            try {
                const resposta = await fetch("http://localhost:8000/Grimorio", {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    method: "POST",
                    body: JSON.stringify(objGrimorio)
                });

                if (resposta.status === 200) {
                    alert("Dados cadastrados com sucesso!!!");
                } else if (resposta.status === 400) {
                    const dados = await resposta.json();
                    alert(`Erro do lado do backend:\n${dados.mensagem}`);
                } else if (resposta.status === 404) {
                    alert("Erro não identificado.");
                }
            } catch (erro) {
                alert("Erro: Erro na requisição do FETCH\n" +
                    "Você ligou o BACKEND com 'npm run dev'?");
            }
        }
    </script>

    <script>
        const container = document.getElementById("estrelas-container");
        for (let i = 0; i < 200; i++) {
            const estrela = document.createElement("div");
            estrela.classList.add("estrela");
            estrela.style.left = Math.random() * 200 + "vw";
            estrela.style.top = Math.random() * 200 + "vh";
            estrela.style.animationDuration = (5 + Math.random() * 5) + "s";
            container.appendChild(estrela);
        }
    </script>
</body>

</html>
